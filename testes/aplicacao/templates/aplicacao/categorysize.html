{% extends "aplicacao/navbar.html" %}

{% block content %}
{% if not empty %}
    <script>
        function getproducts(){
            let cookies = document.cookie.split("; ")
            for (let cookie of cookies){
                const [name, value] = cookie.split("=")
                if (name === "products"){
                    let products = value.split("|")
                    for (let i = 0; i < products.length - 1; i++){
                        console.log(products)
                        products[i] = products[i].split(",-")
                    }
                    return products
                }
            }
            return null
        }
        function addproduct(name, price, printer, size, number){
            let products = getproducts()
            let newProducts = ""
            console.log(products)
            if (products === null){
                document.cookie = "products=" + name + "(" + size + ")" + ",-" + "SIZE" + ",-" + price+ ",-" + printer + "|" + number + "; path=/commands";
            } else {
                if (products[products.length - 1] != number){
                    document.cookie = "products=" + name + ",-" + "SIZE" + ",-" + price + ",-" + printer + "|" + number + "; path=/commands";
                    return
                }
                console.log(products.length)
                for (let i = 0; i < products.length - 1; i++){
                    console.log(products[i])
                    newProducts = newProducts + products[i][0] + ",-" + products[i][1] + ",-" + products[i][2] + ",-" + products[i][3] + "|"
                }
                newProducts = newProducts + name + " (" + size + ")" + ",-" + "SIZE" + ",-" + price + ",-" + printer + "|" + number + "; path=/commands";
                document.cookie = "products=" + newProducts
            }
        }
            
    </script>
    <div style="display:flex; align-items:center; flex-wrap: wrap; justify-content: center">
    {% for product in products %}
            <button onclick="addproduct('{{product.name}}', '{{product.price}}', '{{printer}}', '{{product.size}}', '{{number}}')" style="display:flex; background-color:#ccc; color:#000; text-decoration:none; width:150px; height:100px; margin:10px; position:relative; border: none;"><p style="position:absolute; top: 3px; left: 3px;">{{product.size}}</p><p style="position: absolute; right:3px; bottom: 1px;">{{product.price}}</p></button>
    {% endfor %}
    </div>
{% endif %}
    <nav class="class=navbar fixed-bottom" style="background-color:#ccc; height:80px">
        <a class="btn btn-success btn-lg" style="max-width: 40%; max-height:80%; margin-top:15px; margin-left:20px" href="{% url 'orderrevision' number %}">Revisar pedido</a>
        
    </nav>
{% endblock %}