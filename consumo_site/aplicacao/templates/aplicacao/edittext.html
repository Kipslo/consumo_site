{% extends "aplicacao/navbar.html" %}
{% load static %}
{% block content %}
<script src="{% static 'js/products.js' %}"></script>
<script>
    
    function addtext(){
        let listen = getProducts();
        let text = document.querySelector("#inputtext").value;
        let textlisten = listen['{{indexofproduct}}'][6];
        let permission = true;
        for(let i = 0; i < listen['{{indexofproduct}}'][6].length; i++){
            if (text === listen['{{indexofproduct}}'][6][i]){
                permission = false
                break
            } else if (listen['{{indexofproduct}}'][6][i] === ""){
                textlisten[i] = text
                permission = false
                break
            }
        }
        if (permission){
            textlisten.push(text);
        }
        console.log(textlisten)
        listen['{{indexofproduct}}'][6] = textlisten
        saveProducts(listen)
        location.reload()
    }
    function removetext(text){
        let listen = getProducts()
        let textlisten = []
        for(let i = 0; i < listen['{{indexofproduct}}'][6].length; i++){
            if (text !== listen['{{indexofproduct}}'][6][i] && listen['{{indexofproduct}}'][6][i] !== ""){
                textlisten.push(listen['{{indexofproduct}}'][6][i])
            }
        }
        listen['{{indexofproduct}}'][6] = textlisten
        saveProducts(listen)
        location.reload()
    }
    function changetext(text, index){
        let checkbox = document.querySelectorAll(".checkbox")[index];
        let listen = getProducts();
        if (checkbox.checked){
            if (listen['{{indexofproduct}}'][6][0] === "" || listen['{{indexofproduct}}'][6].length === 0){
                listen['{{indexofproduct}}'][6][0] = text;
            } else {
                listen['{{indexofproduct}}'][6].push(text);
            }
        } else {
            let textlisten = [];
            for(let i = 0; i < listen['{{indexofproduct}}'][6].length; i++){
                if (text !== listen['{{indexofproduct}}'][6][i]){
                    textlisten.push(listen['{{indexofproduct}}'][6][i]);
                }
            }
            listen['{{indexofproduct}}'][6] = textlisten
        }
        saveProducts(listen)
        
    }
</script>
<div style="display:flex; align-items:center; flex-wrap: wrap; justify-content: center">
    {% for predeftext in predeftexts %}
         <div class="" style="display:flex; width: 90%;height:80px; background-color:#ccc; margin:auto; margin-bottom:5px">
             <div style="display:flex; height: 100%; width: auto; align-items: center; flex-grow: 1">
                 <h2>{{predeftext.text}}</h2>    
             </div>
             <form style="display: flex; justify-content: center; align-items: center; height: 100%; width: 50px;">
                 <input class="checkbox" style="width: 30px; height: 30px;" type="checkbox" onchange="changetext('{{predeftext.text}}', '{{predeftext.cod}}')"{% if predeftext.active %} checked{% endif %}>
             </form>
        </div>
    {% endfor %}
    {% for text in texts %}
        <div class="" style="display:flex; width: 90%;height:80px; background-color:#ccc; margin:auto; margin-bottom:5px">
            <div style="display:flex; height: 100%; width: auto; align-items: center; flex-grow: 1">
                <h2>{{text.text}}</h2>    
            </div>
            <button style="height: 100%; width: 90px;" onclick="removetext('{{text.text}}')">Excluir</button>
        </div>
    {% endfor %}
        <div class="" style="display:flex; width: 90%;height:80px; background-color:#ffffff; margin:auto; margin-bottom:5px">
            <form style="display:flex; height: 100%; width: auto; align-items: center; flex-grow: 1">
                <input id="inputtext" style="margin-right: 10px; flex-grow: 1; height: 35px;">
                    <h2>{{predeftext.text}}</h2>
                </input>
            </form>
            <button style="height: 100%; width: 90px; height: 37px; margin-top: 21px" onclick="addtext()">Adicionar</button>
        </div>
</div>
<nav class="class=navbar fixed-bottom" style="background-color:#ccc; height:80px">
    <a class="btn btn-success btn-lg" style="max-width: 40%; max-height:80%; margin-top:15px; margin-left:20px" href="{% url 'orderrevision' number %}">Voltar</a>
        
</nav>
{% endblock %}